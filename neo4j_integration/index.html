<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:image:alt" content="Justin Napolitano"/><meta data-react-helmet="true" name="twitter:image" content="undefined/static/acfac79560b8c0f033301fb165d0ca3b/8d197/post-image.png"/><meta data-react-helmet="true" name="og:image:alt" content="Justin Napolitano"/><meta data-react-helmet="true" name="og:image" content="undefined/static/acfac79560b8c0f033301fb165d0ca3b/8d197/post-image.png"/><meta data-react-helmet="true" name="twitter:description" content="Integrate JSON data from a rest API into your Neo4j Stack"/><meta data-react-helmet="true" name="twitter:title" content="Integrating JSON data to your Neo4j Stack"/><meta data-react-helmet="true" name="twitter:creator" content="just_napolitano"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:description" content="Integrate JSON data from a rest API into your Neo4j Stack"/><meta data-react-helmet="true" property="og:title" content="Integrating JSON data to your Neo4j Stack"/><meta data-react-helmet="true" name="description" content="Integrate JSON data from a rest API into your Neo4j Stack"/><meta name="generator" content="Gatsby 4.12.1"/><style data-href="/styles.5ed63f97d76756aacddc.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5}*,:after,:before{box-sizing:border-box}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:var(--fontSize-root);line-height:var(--lineHeight-normal)}body{color:var(--color-text);font-family:var(--font-body);font-size:var(--fontSize-1)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);border:0;height:1px}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);letter-spacing:-.025em;line-height:var(--lineHeight-tight);margin-bottom:var(--spacing-6);margin-top:var(--spacing-12)}h2,h3,h4,h5,h6{color:var(--color-heading);font-weight:var(--fontWeight-bold)}h1{color:var(--color-heading-black);font-size:var(--fontSize-6);font-weight:var(--fontWeight-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{--baseline-multiplier:0.179;--x-height-multiplier:0.35;line-height:var(--lineHeight-relaxed);margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{list-style-image:none;list-style-position:outside;margin-bottom:var(--spacing-8);margin-left:var(--spacing-0);margin-right:var(--spacing-0)}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{border-left:var(--spacing-1) solid var(--color-primary);color:var(--color-text-light);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{border-collapse:collapse;border-spacing:.25rem;margin-bottom:var(--spacing-8);width:100%}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}.global-wrapper{margin:var(--spacing-0) auto;max-width:var(--maxWidth-wrapper);padding:var(--spacing-10) var(--spacing-5)}.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-20)}.global-header{margin-bottom:var(--spacing-12)}.main-heading{font-size:var(--fontSize-7);margin:0}.post-list-item{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.post-list-item p{margin-bottom:var(--spacing-0)}.post-list-item h2{color:var(--color-primary);font-size:var(--fontSize-4);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item header{margin-bottom:var(--spacing-4)}.header-link-home{font-family:var(--font-heading);font-size:var(--fontSize-2);font-weight:var(--fontWeight-bold);text-decoration:none}.bio{display:flex;margin-bottom:var(--spacing-16)}.bio p,.bio-avatar{margin-bottom:var(--spacing-0)}.bio-avatar{border-radius:100%;margin-right:var(--spacing-4);min-width:50px}.blog-post header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post header p{font-family:var(--font-heading);font-size:var(--fontSize-2)}.blog-post-nav ul{margin:var(--spacing-0)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media (max-width:42rem){blockquote{margin-left:var(--spacing-0);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4)}ol,ul{list-style-position:inside}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="alternate" type="application/rss+xml" title="Gatsby Starter Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=e8d56e807ace6dccd6cb4fe2ee4f7ab7" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=e8d56e807ace6dccd6cb4fe2ee4f7ab7"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=e8d56e807ace6dccd6cb4fe2ee4f7ab7"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=e8d56e807ace6dccd6cb4fe2ee4f7ab7"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=e8d56e807ace6dccd6cb4fe2ee4f7ab7"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=e8d56e807ace6dccd6cb4fe2ee4f7ab7"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=e8d56e807ace6dccd6cb4fe2ee4f7ab7"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=e8d56e807ace6dccd6cb4fe2ee4f7ab7"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=e8d56e807ace6dccd6cb4fe2ee4f7ab7"/><title data-react-helmet="true">Integrating JSON data to your Neo4j Stack | Justin&#x27;s Data Blog</title><link as="script" rel="preload" href="/webpack-runtime-8d4d3bcfd5afb11d1043.js"/><link as="script" rel="preload" href="/framework-e413e527015be9a1bdfd.js"/><link as="script" rel="preload" href="/app-c8d1e6b1e07552f29524.js"/><link as="script" rel="preload" href="/commons-9979cba14fa891b0ecd4.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-2fd61fd1c97edc75b172.js"/><link as="fetch" rel="preload" href="/page-data/neo4j_integration/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3257411868.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="global-wrapper" data-is-root-path="false"><header class="global-header"><a class="header-link-home" href="/">Justin&#x27;s Data Blog</a></header><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">Integrating JSON data to your Neo4j Stack</h1><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:62.5%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAChUlEQVQ4y2WTW3PaSBSE/f//xr6kKlW7lbhcu2uDCba4mpsAI4lLJLAEEmgkjUYS4elLIeKkSB5OzTyc09N9uufGshacTifyPKcoCo7HY1l5liFlQqZSUimRMi0rTS8lpfxxJsTuAOX1UMmeG9Occzp9Q6UpeV4Qi5C53mfcqbOcDrG9A1Ip/H2EvxekcUQcil/AcczXLw8s/v+M8FxuTMMqmcVxjFIZ241Nu3pL5dMH9FYNe7Um2PklIyFiXupdelWNKBQopcq5dk2j/m+Vnbe9AB6PBUmSkCqFCEMsvYfefGQ5mzB+btO+q7B3XeJE0npso9W6RFFMlmWkMsZo3THT/kEE7jWgUil+mNAaOwT+jlhEjLUOzdt7WpUGq9kcbeRg2gHPow19w8U/RDQGM6rtMbvgcA14liVTyTYQGHZAFEWIULA25zTu7lnoU9buDtt54/llxmTh4bgBWuUjldu/2Hmb3ySnKVmmSilnRyMRlaCut2MymjAxVvQnFpZpoOsmwW5PpiSvepfJsMlh7/8yRZ2Z+RHPX/p4jk0UhhgvPcyBznK1oVNr0PzvgV53gG1/pVFtYIxeSwJ58Y3ieCo9+AmYppLDQTDuDpnPbRzXp/PYYKR18L0t3fsatY9/06w3sVY2vvuGOISlqrO695X9IbnIMyKpmI5tek9D+jWNYLvFNi309oDxYMhTo0Nn4rAXSZnf95Cfqwz2lSlSkimF82pjTxcsRhM2iyXedou5WmM6PvWuxXC6wj/EZTLe5y4MzTnF8Xj1yvmuMkWaFwz7UzoPT0ytN3qvTslod4gJRVTuXf7O0DAsVFb8AXiJUIp7jslyjYhiwvjSo372Xf/r88/5DmrPtszs6JbsAAAAAElFTkSuQmCC" alt=""/><picture><source type="image/avif" data-srcset="/static/acfac79560b8c0f033301fb165d0ca3b/c0126/post-image.avif 750w,/static/acfac79560b8c0f033301fb165d0ca3b/c296e/post-image.avif 1000w" sizes="100vw"/><source type="image/webp" data-srcset="/static/acfac79560b8c0f033301fb165d0ca3b/59596/post-image.webp 750w,/static/acfac79560b8c0f033301fb165d0ca3b/904ec/post-image.webp 1000w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/acfac79560b8c0f033301fb165d0ca3b/8d197/post-image.png" data-srcset="/static/acfac79560b8c0f033301fb165d0ca3b/d734b/post-image.png 750w,/static/acfac79560b8c0f033301fb165d0ca3b/8d197/post-image.png 1000w" alt="Justin Napolitano"/></picture><noscript><picture><source type="image/avif" srcSet="/static/acfac79560b8c0f033301fb165d0ca3b/c0126/post-image.avif 750w,/static/acfac79560b8c0f033301fb165d0ca3b/c296e/post-image.avif 1000w" sizes="100vw"/><source type="image/webp" srcSet="/static/acfac79560b8c0f033301fb165d0ca3b/59596/post-image.webp 750w,/static/acfac79560b8c0f033301fb165d0ca3b/904ec/post-image.webp 1000w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/acfac79560b8c0f033301fb165d0ca3b/8d197/post-image.png" srcSet="/static/acfac79560b8c0f033301fb165d0ca3b/d734b/post-image.png 750w,/static/acfac79560b8c0f033301fb165d0ca3b/8d197/post-image.png 1000w" alt="Justin Napolitano"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><p>May 16, 2022</p><p>Integrate JSON data from a rest API into your Neo4j Stack</p><p>Justin Napolitano</p></header><section itemProp="articleBody"><h2>Introduction</h2>
<p>In a previous <a href="https://blog.jnapolitano.io/loc_crawler/">post</a>, I detailed the process of crawling the Library of Congress API to generate json files that could be intergrated into you DB of choice.</p>
<p>In this discussion, we will integrate JSON data into a Neo4j graph database.</p>
<h2>Overview</h2>
<p>The process is fairly straightforward.  The most difficult part is wrangling your json data into the right format for integration.</p>
<p>The main function first instantiates the database config informormation.  It then gets the cwd from a context manager.  We then import the files to be integrated.  A master subject table is created to record only unique subjects to avoid duplicates.  Finally, a json pipeline extracts the data from json, transforms it to integrate into neo4j, and finally we upload using the neomodels api.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    neo_applified <span class="token operator">=</span> instantiate_neo_model_api<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cwd <span class="token operator">=</span> get_cwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
    file_list <span class="token operator">=</span> get_files<span class="token punctuation">(</span>cwd <span class="token operator">=</span> cwd<span class="token punctuation">)</span>
    master_subject_table <span class="token operator">=</span> create_master_subject_table<span class="token punctuation">(</span><span class="token punctuation">)</span>
    json_pipeline<span class="token punctuation">(</span>file_list<span class="token operator">=</span>file_list<span class="token punctuation">,</span> master_subject_table<span class="token operator">=</span>master_subject_table<span class="token punctuation">)</span></code></pre></div>
<h2>Instantiate Neo Model Api</h2>
<p>I extended the neo model api with a few helper functions.  The repo is found at <a href="https://github.com/justin-napolitano/neo4jAPI">https://github.com/justin-napolitano/neo4jAPI</a>.</p>
<p>You can also review the snapshot below.</p>
<p>We will be calling the initation function to set the config information, update, create Case, and Create Subject classes during this review.</p>
<p>create subject calls the custom subject class and returns an object that can later be integrated into the db with the .save() function.</p>
<p>Create case does exactly the same.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> date
<span class="token keyword">from</span> shelve <span class="token keyword">import</span> Shelf
<span class="token keyword">from</span> neomodel <span class="token keyword">import</span> <span class="token punctuation">(</span>config<span class="token punctuation">,</span> StructuredNode<span class="token punctuation">,</span> StringProperty<span class="token punctuation">,</span> IntegerProperty<span class="token punctuation">,</span>
    UniqueIdProperty<span class="token punctuation">,</span> RelationshipTo<span class="token punctuation">,</span> BooleanProperty<span class="token punctuation">,</span> EmailProperty<span class="token punctuation">,</span> Relationship<span class="token punctuation">,</span> db<span class="token punctuation">)</span>
<span class="token keyword">from</span> pprint <span class="token keyword">import</span> pprint

<span class="token keyword">class</span> <span class="token class-name">neoAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>uri<span class="token punctuation">,</span>user<span class="token punctuation">,</span>psw<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>db_init <span class="token operator">=</span> self<span class="token punctuation">.</span>instantiate_neo_model_session<span class="token punctuation">(</span>uri<span class="token punctuation">,</span>user<span class="token punctuation">,</span>psw<span class="token punctuation">)</span>    
        
    
    <span class="token keyword">def</span> <span class="token function">instantiate_neo_model_session</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span>user<span class="token punctuation">,</span>psw<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        <span class="token comment">#config.DATABASE_URL = 'neo4j+s://{}:{}@{}'.format(user, psw, uri)</span>
        config<span class="token punctuation">.</span>DATABASE_URL <span class="token operator">=</span><span class="token string">'bolt://neo4j:beautiful@localhost:7687'</span>
        <span class="token comment">#config.DATABASE_URL = uri</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>


    <span class="token keyword">def</span> <span class="token function">standard_query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        results<span class="token punctuation">,</span> meta <span class="token operator">=</span> db<span class="token punctuation">.</span>cypher_query<span class="token punctuation">(</span>query<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
        people <span class="token operator">=</span> <span class="token punctuation">[</span>Person<span class="token punctuation">.</span>inflate<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> results<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">create_case_node</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> dates<span class="token punctuation">,</span> group<span class="token punctuation">,</span>name<span class="token punctuation">,</span> pdf<span class="token punctuation">,</span> shelf_id<span class="token punctuation">,</span> subject<span class="token punctuation">,</span> title<span class="token punctuation">,</span> url<span class="token punctuation">,</span> subject_relationship <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Case<span class="token punctuation">(</span>date<span class="token operator">=</span>date<span class="token punctuation">,</span> dates<span class="token operator">=</span>dates<span class="token punctuation">,</span> group<span class="token operator">=</span>group<span class="token punctuation">,</span>name<span class="token operator">=</span>name<span class="token punctuation">,</span> pdf<span class="token operator">=</span>pdf<span class="token punctuation">,</span> shelf_id<span class="token operator">=</span>shelf_id<span class="token punctuation">,</span> subject<span class="token operator">=</span>subject<span class="token punctuation">,</span> title<span class="token operator">=</span>title<span class="token punctuation">,</span> url<span class="token operator">=</span>url<span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">create_city_node</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> City<span class="token punctuation">(</span>name <span class="token operator">=</span> name<span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">create_country_node</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Country<span class="token punctuation">(</span>code <span class="token operator">=</span> code<span class="token punctuation">,</span> name <span class="token operator">=</span> name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_state_node</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> State<span class="token punctuation">(</span>code <span class="token operator">=</span> code<span class="token punctuation">,</span> name <span class="token operator">=</span> name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_realtor_search_url_node</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Realtor_Search_URL<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span> is_root <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> is_sibling <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> is_parent<span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> is_child <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> searched <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_root_node</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'realtor.com'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Root<span class="token punctuation">(</span>is_root <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>name <span class="token operator">=</span> name<span class="token punctuation">,</span>is_parent <span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> is_sibling <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> is_child <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> url <span class="token operator">=</span> url<span class="token punctuation">)</span>
        uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_child_node</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'realtor.com'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Child<span class="token punctuation">(</span>is_root <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>name <span class="token operator">=</span> name<span class="token punctuation">,</span>is_parent <span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> is_sibling <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> is_child <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> url <span class="token operator">=</span> url<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_parent_node</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'realtor.com'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Parent<span class="token punctuation">(</span>is_root <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>name <span class="token operator">=</span> name<span class="token punctuation">,</span>is_parent <span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> is_sibling <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> is_child <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> url <span class="token operator">=</span> url<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create_sibling_node</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">'realtor.com'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Sibling<span class="token punctuation">(</span>is_root <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>name <span class="token operator">=</span> name<span class="token punctuation">,</span>is_parent <span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> is_sibling <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> is_child <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> url <span class="token operator">=</span> url<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_relationship</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
      
        
        rel <span class="token operator">=</span> source<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>target<span class="token punctuation">)</span>
        <span class="token keyword">return</span> rel

        <span class="token comment">#print("{}"+".connect" + "{}".format(source,target))</span>
        
    <span class="token keyword">def</span> <span class="token function">create_subject_node</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Subject<span class="token punctuation">(</span>name <span class="token operator">=</span> name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> db<span class="token punctuation">.</span>transaction<span class="token punctuation">:</span>
            <span class="token keyword">return</span> obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uuid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Case</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    date <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    dates <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    group <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    pdf <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> 
    shelf_id <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    subject <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment">#primary_topic = StringProperty(unique_index=True, required=True)</span>
    title <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    subject_relationship <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Subject"</span><span class="token punctuation">,</span> <span class="token string">"IS_SUBJECT"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Processed</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">NotProcessed</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    

<span class="token keyword">class</span> <span class="token class-name">City</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    state <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">'State'</span><span class="token punctuation">,</span> <span class="token string">'IS_STATE_OF'</span><span class="token punctuation">)</span>
    country <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">'Country'</span><span class="token punctuation">,</span> <span class="token string">'IS_COUNTRY_OF'</span><span class="token punctuation">)</span>
    
    
<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    code <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    

<span class="token keyword">class</span> <span class="token class-name">State</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    code <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    country <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">'Country'</span><span class="token punctuation">,</span> <span class="token string">'IS_COUNTRY_OF'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Root</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    is_root <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_parent <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_sibling <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_child <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    processed <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Processed"</span><span class="token punctuation">,</span> <span class="token string">"IS_PROCESSED"</span><span class="token punctuation">)</span>
    NotProcessed <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"NotProcessed"</span><span class="token punctuation">,</span> <span class="token string">"NOT_PROCESSED"</span><span class="token punctuation">)</span>
    sibling <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Sibling"</span><span class="token punctuation">,</span><span class="token string">"IS_SIBLING"</span><span class="token punctuation">)</span>
    child <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Child"</span><span class="token punctuation">,</span><span class="token string">"IS_CHILD"</span><span class="token punctuation">)</span>
    parent <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Parent"</span><span class="token punctuation">,</span><span class="token string">"IS_PARENT"</span><span class="token punctuation">)</span>
    root <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Root"</span><span class="token punctuation">,</span> <span class="token string">"IS_ROOT"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    is_root <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_parent <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_sibling <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_child <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    processed <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Processed"</span><span class="token punctuation">,</span> <span class="token string">"IS_PROCESSED"</span><span class="token punctuation">)</span>
    NotProcessed <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"NotProcessed"</span><span class="token punctuation">,</span> <span class="token string">"NOT_PROCESSED"</span><span class="token punctuation">)</span>
    sibling <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Sibling"</span><span class="token punctuation">,</span><span class="token string">"IS_SIBLING"</span><span class="token punctuation">)</span>
    child <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Child"</span><span class="token punctuation">,</span><span class="token string">"IS_CHILD"</span><span class="token punctuation">)</span>
    parent <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Parent"</span><span class="token punctuation">,</span><span class="token string">"IS_PARENT"</span><span class="token punctuation">)</span>
    root <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Root"</span><span class="token punctuation">,</span> <span class="token string">"IS_ROOT"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    is_root <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_parent <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_sibling <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_child <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    processed <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Processed"</span><span class="token punctuation">,</span> <span class="token string">"IS_PROCESSED"</span><span class="token punctuation">)</span>
    NotProcessed <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"NotProcessed"</span><span class="token punctuation">,</span> <span class="token string">"NOT_PROCESSED"</span><span class="token punctuation">)</span>
    sibling <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Sibling"</span><span class="token punctuation">,</span><span class="token string">"IS_SIBLING"</span><span class="token punctuation">)</span>
    child <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Child"</span><span class="token punctuation">,</span><span class="token string">"IS_CHILD"</span><span class="token punctuation">)</span>
    parent <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Parent"</span><span class="token punctuation">,</span><span class="token string">"IS_PARENT"</span><span class="token punctuation">)</span>
    root <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Root"</span><span class="token punctuation">,</span> <span class="token string">"IS_ROOT"</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Sibling</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    is_root <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_parent <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_sibling <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_child <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    processed <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Processed"</span><span class="token punctuation">,</span> <span class="token string">"IS_PROCESSED"</span><span class="token punctuation">)</span>
    NotProcessed <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"NotProcessed"</span><span class="token punctuation">,</span> <span class="token string">"NOT_PROCESSED"</span><span class="token punctuation">)</span>
    sibling <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Sibling"</span><span class="token punctuation">,</span><span class="token string">"IS_SIBLING"</span><span class="token punctuation">)</span>
    child <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Child"</span><span class="token punctuation">,</span><span class="token string">"IS_CHILD"</span><span class="token punctuation">)</span>
    parent <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Parent"</span><span class="token punctuation">,</span><span class="token string">"IS_PARENT"</span><span class="token punctuation">)</span>
    root <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Root"</span><span class="token punctuation">,</span> <span class="token string">"IS_ROOT"</span><span class="token punctuation">)</span>
    
<span class="token keyword">class</span> <span class="token class-name">Realtor_com</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    is_realtor_com <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Realtor_Search_URL</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    searched <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_root <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_child <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_parent <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    is_sibling <span class="token operator">=</span> BooleanProperty<span class="token punctuation">(</span>unique_index <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment">#state = Relationship('State', 'OF')</span>
    state <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">'State'</span><span class="token punctuation">,</span> <span class="token string">'IS_STATE_OF'</span><span class="token punctuation">)</span>
    city <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">'City'</span><span class="token punctuation">,</span> <span class="token string">'IS_CITY_OF'</span><span class="token punctuation">)</span>
    root <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">'Root'</span><span class="token punctuation">,</span><span class="token string">'IS_ROOT'</span><span class="token punctuation">)</span>
    child <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">'Child'</span><span class="token punctuation">,</span><span class="token string">"IS_CHILD"</span><span class="token punctuation">)</span>
    parent <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">'Parent'</span><span class="token punctuation">,</span> <span class="token string">"IS_PARENT"</span><span class="token punctuation">)</span>
    sibling <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">'Sibling'</span><span class="token punctuation">,</span> <span class="token string">"IS_SIBLING"</span><span class="token punctuation">)</span>
    realtor_com <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">'Realtor_com'</span><span class="token punctuation">,</span> <span class="token string">"IS_REALTOR.COM_URL"</span><span class="token punctuation">)</span>
    processed <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Processed"</span><span class="token punctuation">,</span> <span class="token string">"IS_PROCESSED"</span><span class="token punctuation">)</span>
    NotProcessed <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"NotProcessed"</span><span class="token punctuation">,</span> <span class="token string">"NOT_PROCESSED"</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    full_name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    email <span class="token operator">=</span> EmailProperty<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<h2>Get Files</h2>
<p>The get_files function returns a list of files within the input directory.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">
<span class="token keyword">def</span> <span class="token function">get_files</span><span class="token punctuation">(</span>cwd <span class="token operator">=</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> input_directory <span class="token operator">=</span> <span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    path <span class="token operator">=</span> os<span class="token punctuation">.</span>sep<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>cwd<span class="token punctuation">,</span>input_directory<span class="token punctuation">]</span><span class="token punctuation">)</span>
    file_list<span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">"**/*.json"</span><span class="token punctuation">,</span> recursive<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  
    <span class="token keyword">return</span> file_list
</code></pre></div>
<h2>Create Master Subject File</h2>
<p>Create maseter subject table generates an empty dataframe that will record every unique subject experienced in the data.</p>
<p>I will improve upon this later, by uploading a master file that will be saved following each modification.  This would enable resuming the process following an error or fault.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">
<span class="token keyword">def</span> <span class="token function">create_master_subject_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    table <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>
    table<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    table<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span><span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    table<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    <span class="token keyword">return</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>
</code></pre></div>
<h2>Json Pipeline function</h2>
<p>The json pipeline function is the runner for the etl job.  It loads each file into dataframe, manipulates the data accordingly, and updates the neo4j database.</p>
<p>When I refactor the code, I will most likely create an object that calls static functions to generate then desired output.</p>
<p>I may also seperate the case, subject, and relationship pipeline into seperate classes in order to avoid shadowing functions within functions.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">json_pipeline</span><span class="token punctuation">(</span>file_list<span class="token punctuation">,</span> master_subject_table<span class="token punctuation">)</span><span class="token punctuation">:</span>
    case_counter <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>
        
        data <span class="token operator">=</span> load_json_data<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'results'</span><span class="token punctuation">]</span>
        <span class="token comment">#pprint(data)</span>
        <span class="token comment">#pprint(data[0])</span>
        
        <span class="token comment">#filtered_data = filter_json_data(json_data = data, filter = filter)</span>

        <span class="token comment"># Creating the case nodes transaction nodes and df</span>
        data <span class="token operator">=</span> clean_json_data<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        case_data <span class="token operator">=</span> stringify_json_values<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        case_data <span class="token operator">=</span> pandify_case_data<span class="token punctuation">(</span>case_data<span class="token punctuation">)</span>
        case_data <span class="token operator">=</span> nodify_case_data<span class="token punctuation">(</span>case_data <span class="token operator">=</span> case_data<span class="token punctuation">)</span>
        
        <span class="token comment"># Creating the subject nodes transaction nodes and df</span>
        subject_list <span class="token operator">=</span> slice_subject_data<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        subject_list <span class="token operator">=</span> identify_unique_subjects<span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span>
        subject_lookup_table <span class="token operator">=</span> create_subject_lookup_table<span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span>
        master_subject_table <span class="token operator">=</span> integrate_to_master_table<span class="token punctuation">(</span>subject_lookup_table<span class="token punctuation">,</span>master_subject_table<span class="token punctuation">)</span>
        <span class="token comment">#pprint(master_subject_table.duplicated())</span>
        case_counter <span class="token operator">=</span> case_counter <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>case_data<span class="token punctuation">)</span>

        master_subject_table <span class="token operator">=</span> nodify_subjects<span class="token punctuation">(</span>master_subject_table<span class="token punctuation">)</span>

        <span class="token comment">#pprint(case_data)</span>
        <span class="token comment">#pprint(master_subject_table['transaction'])</span>
        <span class="token comment">#lets save data to the database</span>

        master_subject_table <span class="token operator">=</span> submit_subjects_to_db<span class="token punctuation">(</span>master_subject_table<span class="token punctuation">)</span>
        case_data <span class="token operator">=</span> submit_cases_to_db<span class="token punctuation">(</span>case_data <span class="token operator">=</span> case_data<span class="token punctuation">)</span>

        <span class="token comment"># Create Relationships</span>

        relationship_list<span class="token operator">=</span> create_relationship_table<span class="token punctuation">(</span>case_data<span class="token operator">=</span>case_data<span class="token punctuation">,</span> master_subject_table<span class="token operator">=</span>master_subject_table<span class="token punctuation">)</span></code></pre></div>
<h3>Case Pipeline</h3>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># Creating the case nodes transaction nodes and df</span>
data <span class="token operator">=</span> clean_json_data<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
case_data <span class="token operator">=</span> stringify_json_values<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
case_data <span class="token operator">=</span> pandify_case_data<span class="token punctuation">(</span>case_data<span class="token punctuation">)</span>
case_data <span class="token operator">=</span> nodify_case_data<span class="token punctuation">(</span>case_data <span class="token operator">=</span> case_data<span class="token punctuation">)</span></code></pre></div>
<p>To create the case nodes four functions are called.</p>
<h4>Clean Json Data</h4>
<p>The first is clean_json_data which is actually unnecessary.  The only operation that is required is moving the pdf froma list to a dicktionary key.  It should and will be refactored.  As it stands now, I am leaving iut as an artifact of a previous workflow.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">
<span class="token keyword">def</span> <span class="token function">clean_json_data</span><span class="token punctuation">(</span>filtered_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Select the keys that I want from the dictionary</span>
    <span class="token comment"># filter appropriatly into a df </span>
    <span class="token comment"># write df to file</span>
    <span class="token comment">#print(type(filtered_data))</span>
    <span class="token comment">#pprint(filtered_data)</span>
    <span class="token keyword">for</span> data <span class="token keyword">in</span> filtered_data<span class="token punctuation">:</span>
        <span class="token comment">#pprint(data)</span>
        <span class="token comment">#creat a dictionary of columns and values for each row.  Combine them all into a df when we are done</span>
        <span class="token comment"># each dictionary must be a row.... which makes perfect sense, but they can not be nested... </span>
        item <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        resources <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'resources'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        index <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        language <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'language'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        online_format<span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'online_format'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        original_format <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'original_format'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        kind <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        image_url <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'image_url'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        hassegments <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'hassegments'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        extract_timestamp <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'extract_timestamp'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        timestampe <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'timestamp'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        mimetype<span class="token operator">=</span>data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'mime_type'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            pdf <span class="token operator">=</span> resources<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'pdf'</span><span class="token punctuation">]</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span> 
            pdf <span class="token operator">=</span> <span class="token string">"noPdf"</span>
        data<span class="token punctuation">[</span><span class="token string">"pdf"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pdf
        data<span class="token punctuation">[</span><span class="token string">'search_index'</span><span class="token punctuation">]</span> <span class="token operator">=</span> index
    </code></pre></div>
<h4>Stringify Json Data</h4>
<p>The Second is Stringify_json_data.  The imporatance of this function is that it creates strings from lists in order to properly integrate into the neo4j databse.  Iterables are permitted, however they can not be searched.  For my use case, I decided to create csv strings instead that can later be parsed if necessary.</p>
<p>This function also moves the subject list to a dedicated key in the dictionary.  This is important because it is used to generate the subject tables.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">stringify_json_values</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> <span class="token builtin">dict</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        subject_list <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> key <span class="token keyword">in</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
                tmp_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    item <span class="token operator">=</span> item<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span>
                    tmp_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
                <span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> tmp_list

                <span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token builtin">dict</span><span class="token punctuation">[</span><span class="token string">'subject_list'</span><span class="token punctuation">]</span> <span class="token operator">=</span> subject_list

                
    <span class="token keyword">return</span> data</code></pre></div>
<h4>Pandify Case Data</h4>
<p>The next function creates a pandas dataframe from a list of dictionaries.  Thankfully this is easy to accommplish.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">pandify_case_data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#case_df = pd.concat(data, sort=False)</span>
    df<span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    df<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    <span class="token keyword">return</span> df</code></pre></div>
<h4>Nodify Case Data</h4>
<p>Nodify creates transaction objects that can be saved to the neo4j databse.  I call the neomodel api to generate the results and save them into a dataframe that is used to apply the upload with a lambda function.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">nodify_case_data</span><span class="token punctuation">(</span>case_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#non_submitted_nodes = case_data[case_data.notna()]</span>
    non_submitted_nodes <span class="token operator">=</span> case_data<span class="token punctuation">[</span>case_data<span class="token punctuation">.</span>notna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment">#pprint(non_submitted_nodes)</span>
    case_nodes <span class="token operator">=</span> non_submitted_nodes<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_case_node<span class="token punctuation">(</span>date <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dates<span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'dates'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>group <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'group'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span>x<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pdf<span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'pdf'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shelf_id <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'shelf_id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> subject<span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> title <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> url <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> subject_relationship<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

    case_data<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> case_nodes
    <span class="token keyword">return</span> case_data
</code></pre></div>
<h3>The Subject Pipeline</h3>
<p>The subject pipeline slices the subject data from the current search result page.</p>
<p>It then identifies the unique subjects</p>
<p>The subject_lookup_table is a dataframe containing the subjects returned by subject list.  They are unique only to the result page.</p>
<p>The master_subject_table is then updated by the integrate_to_master_table function that identifes new subjects to integrate into the master table.</p>
<p>finally, the nodify subject function creates transaction objects to be uploaded to the neo4j db.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">  <span class="token comment"># Creating the subject nodes transaction nodes and df</span>
    subject_list <span class="token operator">=</span> slice_subject_data<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    subject_list <span class="token operator">=</span> identify_unique_subjects<span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span>
    subject_lookup_table <span class="token operator">=</span> create_subject_lookup_table<span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span>
    master_subject_table <span class="token operator">=</span> integrate_to_master_table<span class="token punctuation">(</span>subject_lookup_table<span class="token punctuation">,</span>master_subject_table<span class="token punctuation">)</span>
    <span class="token comment">#pprint(master_subject_table.duplicated())</span>

    master_subject_table <span class="token operator">=</span> nodify_subjects<span class="token punctuation">(</span>master_subject_table<span class="token punctuation">)</span>
    </code></pre></div>
<h4>slice_subject_data</h4>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">slice_subject_data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    subject_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token keyword">case</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        subject_list <span class="token operator">=</span> subject_list <span class="token operator">+</span> <span class="token keyword">case</span><span class="token punctuation">[</span><span class="token string">'subject_list'</span><span class="token punctuation">]</span>
    <span class="token comment">#pprint(subject_list)</span>
    <span class="token keyword">return</span> subject_list</code></pre></div>
<h4>Identify Unique Subjects</h4>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">identify_unique_subjects</span><span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment"># insert the list to the set</span>
    list_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span>
    <span class="token comment"># convert the set to the list</span>
    unique_list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>list_set<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> unique_list
</code></pre></div>
<h4>Create Subject Lookup Table</h4>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">create_subject_lookup_table</span><span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    lookup_table <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>subject_list<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    lookup_table<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    lookup_table<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    <span class="token keyword">return</span> lookup_table</code></pre></div>
<h4>Nodify Subject</h4>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">nodify_subjects</span><span class="token punctuation">(</span>master_subject_table<span class="token punctuation">)</span><span class="token punctuation">:</span>
    non_submitted_nodes <span class="token operator">=</span> master_subject_table<span class="token punctuation">[</span>master_subject_table<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#df[df.isna().any(axis=1)]</span>
    <span class="token comment">#pprint(non_submitted_nodes)</span>
    non_submitted_nodes<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> non_submitted_nodes<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_subject_node<span class="token punctuation">(</span>name <span class="token operator">=</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    master_subject_table<span class="token punctuation">.</span>update<span class="token punctuation">(</span>non_submitted_nodes<span class="token punctuation">)</span>
    <span class="token keyword">return</span> master_subject_table</code></pre></div>
<h3>Uploading Case and Subject data</h3>
<p>With the transaction object dataframes created, we can then update the data to the database.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">master_subject_table <span class="token operator">=</span> submit_subjects_to_db<span class="token punctuation">(</span>master_subject_table<span class="token punctuation">)</span>
case_data <span class="token operator">=</span> submit_cases_to_db<span class="token punctuation">(</span>case_data <span class="token operator">=</span> case_data<span class="token punctuation">)</span></code></pre></div>
<h4>Submit Subjects</h4>
<p>This function selects the subject nodes from the master table that have not been uploaded to the neo4j database.</p>
<p>It identifies na in the submitted collumn in order to slice non-submitted nodes.</p>
<p>If that table can be created we upload all of the df with the update function from the neoapi.  It simply calls the db and calls save() on the object.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">submit_subjects_to_db</span><span class="token punctuation">(</span>master_subject_table<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>
    <span class="token comment">#pprint(master_subject_table)</span>
    <span class="token comment">#non_submitted_nodes=master_subject_table[[master_subject_table['submitted'] == np.nan]]</span>
    non_submitted_nodes <span class="token operator">=</span> master_subject_table<span class="token punctuation">[</span>master_subject_table<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#pprint(non_submitted_nodes)</span>
    <span class="token keyword">if</span> non_submitted_nodes<span class="token punctuation">.</span>empty<span class="token punctuation">:</span>   
        <span class="token keyword">return</span> master_subject_table
    <span class="token keyword">else</span><span class="token punctuation">:</span>
         <span class="token comment">#pprint(non_submitted_nodes)</span>
        non_submitted_nodes<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> non_submitted_nodes<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>update<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        non_submitted_nodes<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    
    <span class="token comment">#test = non_submitted_nodes.iloc[32]['transaction']</span>
    <span class="token comment">#return_obj = neo.neoAPI.update(test)</span>
        master_subject_table<span class="token punctuation">.</span>update<span class="token punctuation">(</span>non_submitted_nodes<span class="token punctuation">)</span>
        <span class="token comment">#pprint(master_subject_table)</span>
        <span class="token keyword">return</span> master_subject_table</code></pre></div>
<h4>Submit Cases</h4>
<p>Initially i had copy and pasted the subject submission function. I realized that the checks were unnecessary.   I am assuming that each result is unique.  Therefore, every case is uploaded.  If it proves that there are duplicates in the database, the neo4j cypher language would permit me to prune those duplicate edges.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">submit_cases_to_db</span><span class="token punctuation">(</span>case_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>

        <span class="token comment">### in theory none of the cases wouldhave been submitted becasue i am pulling them from file.  There is no need to check.. Just submit</span>
    <span class="token comment">#non_submitted_nodes = case_data[case_data['submitted'].isna()].copy()</span>
    <span class="token comment">#pprint(non_submitted_nodes)</span>
    <span class="token comment">##pprint(non_submitted_nodes)</span>
    <span class="token comment">#if non_submitted_nodes.empty:</span>
    <span class="token comment">#    return case_data</span>
    <span class="token comment">#else:</span>
    case_data<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> case_data<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>update<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#Assume all are submitted..</span>
    case_data<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token comment">#test = non_submitted_nodes.iloc[32]['transaction']</span>
    <span class="token comment">#return_obj = neo.neoAPI.update(test)</span>
    <span class="token comment">#case_data.update(non_submitted_nodes)</span>
    <span class="token keyword">return</span> case_data</code></pre></div>
<h3>Submit the Relationships</h3>
<p>The final step is to relate the cases to the subject nodes.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">relationship_list= create_relationship_table(case_data=case_data, master_subject_table=master_subject_table)</code></pre></div>
<p>This is accomplished by calling the relationship function declared in the Case class declared in the neomodel api.</p>
<p>View the reference below:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Case</span><span class="token punctuation">(</span>StructuredNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    uid <span class="token operator">=</span> UniqueIdProperty<span class="token punctuation">(</span><span class="token punctuation">)</span>
    date <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    dates <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    group <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    pdf <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> 
    shelf_id <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    subject <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment">#primary_topic = StringProperty(unique_index=True, required=True)</span>
    title <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> StringProperty<span class="token punctuation">(</span>unique_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    subject_relationship <span class="token operator">=</span> Relationship<span class="token punctuation">(</span><span class="token string">"Subject"</span><span class="token punctuation">,</span> <span class="token string">"IS_SUBJECT"</span><span class="token punctuation">)</span></code></pre></div>
<h4>Create Relationship Table</h4>
<p>To create the relationships the case_data and the master_subject_table are necessary.</p>
<p>for every case a relationship is created to every subject within its subject list.</p>
<p>It is important to note, that in order for this function to work correctly, the cases and subjects must first be submitted to the database.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">
<span class="token keyword">def</span> <span class="token function">create_relationship_table</span><span class="token punctuation">(</span>case_data<span class="token punctuation">,</span> master_subject_table<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#pprint(case_data[])</span>
        <span class="token comment">#test = master_subject_table['subject']</span>
        <span class="token comment"># select </span>
    relationship_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>case_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        unique_dataframe <span class="token operator">=</span> <span class="token punctuation">(</span>master_subject_table<span class="token punctuation">[</span>master_subject_table<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isin<span class="token punctuation">(</span>case_data<span class="token punctuation">[</span><span class="token string">'subject_list'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment">#pprint(unique_dataframe)</span>
        <span class="token keyword">for</span> subject_row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>unique_dataframe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">case</span> <span class="token operator">=</span> case_data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span>
            subject <span class="token operator">=</span> unique_dataframe<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>subject_row<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span>
            <span class="token comment">#create relationship</span>
            <span class="token comment">#pprint(case)</span>
            <span class="token comment">#pprint(subject)</span>
            relationship <span class="token operator">=</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_relationship<span class="token punctuation">(</span><span class="token keyword">case</span><span class="token punctuation">.</span>subject_relationship<span class="token punctuation">,</span>subject<span class="token punctuation">)</span>
            <span class="token comment">#pprint(relationship)</span>
            relationship_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>relationship<span class="token punctuation">)</span>

    <span class="token keyword">return</span> relationship_list</code></pre></div>
<h2>Putting Everything Together</h2>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">
<span class="token comment">#realtor_graph.py</span>


<span class="token comment">#from neo4j_connect_2 import NeoSandboxApp</span>
<span class="token comment">#import neo4j_connect_2 as neo</span>
<span class="token comment">#import GoogleServices as google</span>
<span class="token comment">#from pyspark.sql import SparkSession</span>
<span class="token comment">#from pyspark.sql.functions import struct</span>
<span class="token keyword">from</span> cgitb <span class="token keyword">import</span> lookup
<span class="token keyword">import</span> code
<span class="token keyword">from</span> dbm <span class="token keyword">import</span> dumb
<span class="token keyword">from</span> doctest <span class="token keyword">import</span> master
<span class="token keyword">from</span> hmac <span class="token keyword">import</span> trans_36
<span class="token keyword">import</span> mimetypes
<span class="token keyword">from</span> platform <span class="token keyword">import</span> node
<span class="token keyword">from</span> pprint <span class="token keyword">import</span> pprint
<span class="token keyword">from</span> pty <span class="token keyword">import</span> master_open
<span class="token keyword">from</span> re <span class="token keyword">import</span> sub
<span class="token keyword">from</span> unittest<span class="token punctuation">.</span>util <span class="token keyword">import</span> unorderable_list_difference
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> non_hierarchical
<span class="token keyword">from</span> neomodel <span class="token keyword">import</span> <span class="token punctuation">(</span>config<span class="token punctuation">,</span> StructuredNode<span class="token punctuation">,</span> StringProperty<span class="token punctuation">,</span> IntegerProperty<span class="token punctuation">,</span>
    UniqueIdProperty<span class="token punctuation">,</span> RelationshipTo<span class="token punctuation">,</span> BooleanProperty<span class="token punctuation">,</span> EmailProperty<span class="token punctuation">,</span> Relationship<span class="token punctuation">,</span>db<span class="token punctuation">)</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token comment">#import NeoNodes as nn</span>
<span class="token comment">#import GoogleServices</span>
<span class="token keyword">import</span> neo4jClasses
<span class="token comment">#import sparkAPI as spark</span>
<span class="token keyword">import</span> neoModelAPI <span class="token keyword">as</span> neo
<span class="token keyword">import</span> glob
<span class="token keyword">import</span> os
<span class="token keyword">import</span> json
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment">#from neoModelAPI import NeoNodes as nn</span>


<span class="token keyword">class</span> <span class="token class-name">DataUploadFunctions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">upload_df</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#df.apply(lambda x: pprint(str(x) + str(type(x))))</span>
        
        node_list <span class="token operator">=</span>  df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>update<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">#pprint(node_list)</span>
        <span class="token keyword">return</span>  node_list
    
    <span class="token keyword">def</span> <span class="token function">map_to_df</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df1<span class="token punctuation">,</span>df2<span class="token punctuation">,</span>lookup_value <span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">,</span> lookup_key<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        df1<span class="token punctuation">[</span>lookup_value<span class="token punctuation">]</span> <span class="token operator">=</span> df1<span class="token punctuation">[</span>lookup_key<span class="token punctuation">]</span>
        <span class="token comment">#pprint(df1.columns)</span>
        <span class="token comment">#pprint(df1)</span>
        
        val  <span class="token operator">=</span> df1<span class="token punctuation">[</span>lookup_value<span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>df2<span class="token punctuation">[</span>lookup_key<span class="token punctuation">]</span><span class="token punctuation">,</span>  df2<span class="token punctuation">[</span>lookup_value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> val

    <span class="token keyword">def</span> <span class="token function">set_relationships</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>source_node<span class="token punctuation">,</span> target_node<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#pprint(self.df.columns)</span>
        <span class="token comment">#pprint(source_node)</span>
        rel <span class="token operator">=</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_relationship<span class="token punctuation">(</span>source <span class="token operator">=</span> source_node <span class="token punctuation">,</span>target <span class="token operator">=</span> target_node<span class="token punctuation">)</span>
        <span class="token keyword">return</span> rel

<span class="token keyword">class</span> <span class="token class-name">DataPipelineFunctions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">write_df_to_csv</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">,</span>path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cwd <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
        path <span class="token operator">=</span> os<span class="token punctuation">.</span>sep<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>cwd<span class="token punctuation">,</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>path<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> path

    <span class="token keyword">def</span> <span class="token function">create_city_nodes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        city_nodes <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'city_name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_city_node<span class="token punctuation">(</span>name <span class="token operator">=</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> city_nodes

    <span class="token keyword">def</span> <span class="token function">create_url_nodes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        url_nodes <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'root_realtor_url'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_realtor_search_url_node<span class="token punctuation">(</span>url<span class="token operator">=</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> url_nodes
    
    <span class="token keyword">def</span> <span class="token function">create_root_nodes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        root_nodes <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'root_realtor_url'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_root_node<span class="token punctuation">(</span>url<span class="token operator">=</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> root_nodes

    <span class="token keyword">def</span> <span class="token function">create_country_nodes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        country_nodes <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_country_node<span class="token punctuation">(</span>code <span class="token operator">=</span> x<span class="token punctuation">.</span>country_code<span class="token punctuation">,</span> name <span class="token operator">=</span> x<span class="token punctuation">.</span>country_name<span class="token punctuation">)</span><span class="token punctuation">,</span>axis <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> country_nodes
        

    <span class="token keyword">def</span> <span class="token function">return_unique_country_df</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        df <span class="token operator">=</span> df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'country_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>df<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>difference<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'country_node'</span><span class="token punctuation">,</span><span class="token string">'state_node'</span><span class="token punctuation">,</span><span class="token string">'country_name'</span><span class="token punctuation">,</span> <span class="token string">'country_code'</span><span class="token punctuation">,</span><span class="token string">'state_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token comment">#pprint(df)</span>
        <span class="token keyword">return</span> df


    <span class="token keyword">def</span> <span class="token function">create_state_nodes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        state_nodes <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_state_node<span class="token punctuation">(</span>code <span class="token operator">=</span> x<span class="token punctuation">.</span>state_code<span class="token punctuation">,</span> name <span class="token operator">=</span> x<span class="token punctuation">.</span>state_name<span class="token punctuation">)</span><span class="token punctuation">,</span>axis <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> state_nodes    

    <span class="token keyword">def</span> <span class="token function">return_unique_state_df</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        df <span class="token operator">=</span> df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'state_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>df<span class="token punctuation">.</span>columns<span class="token punctuation">.</span>difference<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'state_node'</span><span class="token punctuation">,</span><span class="token string">'country_node'</span><span class="token punctuation">,</span><span class="token string">'country_code'</span><span class="token punctuation">,</span><span class="token string">'state_name'</span><span class="token punctuation">,</span><span class="token string">'country_name'</span><span class="token punctuation">,</span><span class="token string">'state_code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token comment">#pprint(df)</span>

        <span class="token keyword">return</span> df

    <span class="token keyword">def</span> <span class="token function">rename_columns</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">,</span> mapper <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'city'</span><span class="token punctuation">:</span> <span class="token string">'city_name'</span><span class="token punctuation">,</span> <span class="token string">'state'</span><span class="token punctuation">:</span> <span class="token string">'state_code'</span><span class="token punctuation">,</span><span class="token string">'realtor_url'</span><span class="token punctuation">:</span> <span class="token string">'root_realtor_url'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns <span class="token operator">=</span> mapper<span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">add_country_code</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>country_code <span class="token operator">=</span> <span class="token string">"USA"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> country_code

    <span class="token keyword">def</span> <span class="token function">add_country_name</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>country_name <span class="token operator">=</span> <span class="token string">"United States of America"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> country_name

    <span class="token keyword">def</span> <span class="token function">upload_df</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#df.apply(lambda x: pprint(str(x) + str(type(x))))</span>
        
        node_list <span class="token operator">=</span>  df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>update<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pprint<span class="token punctuation">(</span>node_list<span class="token punctuation">)</span>
        <span class="token keyword">return</span>  node_list
        <span class="token comment">#df['server_node'] =  node_list</span>
        <span class="token comment">#pprint(df)</span>
        
        


    <span class="token keyword">def</span> <span class="token function">set_url_relationships</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#pprint(self.df.columns)</span>
        update_list <span class="token operator">=</span> self<span class="token punctuation">.</span>df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_relationship<span class="token punctuation">(</span>source <span class="token operator">=</span> x<span class="token punctuation">.</span>url_node<span class="token punctuation">.</span>city<span class="token punctuation">,</span>target <span class="token operator">=</span> x<span class="token punctuation">.</span>city_node<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        pprint<span class="token punctuation">(</span>update_list<span class="token punctuation">)</span>
        <span class="token keyword">return</span> update_list
        <span class="token comment">#rel = self.df.url.connect(self.df.city)</span>

    <span class="token keyword">def</span> <span class="token function">set_city_relationships</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#pprint(self.df.columns)</span>
        update_list <span class="token operator">=</span> self<span class="token punctuation">.</span>df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_relationship<span class="token punctuation">(</span>source <span class="token operator">=</span> x<span class="token punctuation">.</span>city_node<span class="token punctuation">.</span>country<span class="token punctuation">,</span>target <span class="token operator">=</span> x<span class="token punctuation">.</span>country_node<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        update_list <span class="token operator">=</span> self<span class="token punctuation">.</span>df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_relationship<span class="token punctuation">(</span>source <span class="token operator">=</span> x<span class="token punctuation">.</span>city_node<span class="token punctuation">.</span>state<span class="token punctuation">,</span>target <span class="token operator">=</span> x<span class="token punctuation">.</span>state_node<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        pprint<span class="token punctuation">(</span>update_list<span class="token punctuation">)</span>
        <span class="token comment">#rel = self.df.url.connect(self.df.city)</span>

    <span class="token keyword">def</span> <span class="token function">set_state_relationships</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#pprint(self.df.columns)</span>
        neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_relationship<span class="token punctuation">(</span>source <span class="token operator">=</span> self<span class="token punctuation">.</span>unique_state_nodes<span class="token punctuation">.</span>state_node<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>country<span class="token punctuation">,</span>target <span class="token operator">=</span> self<span class="token punctuation">.</span>unique_state_nodes<span class="token punctuation">.</span>country_node<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment">#update_list = self.unique_state_nodes.apply(lambda x: neo.neoAPI.create_relationship(source = x.state_node.country,target = x.country_node.name), axis=1)</span>
        <span class="token comment">#pprint(update_list)</span>
        <span class="token comment">#rel = self.df.url.connect(self.df.city)</span>




    <span class="token keyword">def</span> <span class="token function">group_by_state</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        grouped <span class="token operator">=</span> self<span class="token punctuation">.</span>df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>by <span class="token operator">=</span> <span class="token string">"state_name"</span><span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">load_data_to_pandas_df</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>file_path <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> file_path <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>

            <span class="token keyword">with</span> <span class="token builtin">open</span> <span class="token punctuation">(</span>file_path<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
                df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_json<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> df
    
    <span class="token keyword">def</span> <span class="token function">nodify_city_column</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>df<span class="token punctuation">[</span><span class="token string">'city_node'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>df<span class="token punctuation">[</span><span class="token string">'city'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_city_node<span class="token punctuation">(</span>name <span class="token operator">=</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        
        <span class="token comment">#pprint(df.city_nodes)</span>



    <span class="token keyword">def</span> <span class="token function">nodify_states_column</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>

        unique_states <span class="token operator">=</span> self<span class="token punctuation">.</span>df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#pprint(state_dict)</span>

        unique_states<span class="token punctuation">[</span><span class="token string">'state_node'</span><span class="token punctuation">]</span> <span class="token operator">=</span> unique_states<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_state_node<span class="token punctuation">(</span>name <span class="token operator">=</span> x<span class="token punctuation">.</span>state_name<span class="token punctuation">,</span> code <span class="token operator">=</span> x<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment">#pprint(unique_states)</span>
        <span class="token comment">#self.df['state_nodes'] = unique_states['state_nodes'] where unique_states[state_name] = self.df_stateName</span>
        self<span class="token punctuation">.</span>df<span class="token punctuation">[</span><span class="token string">"state_node"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>df<span class="token punctuation">[</span><span class="token string">'state_name'</span><span class="token punctuation">]</span>
        <span class="token comment">#self.df['state_node'] =</span>
        <span class="token comment">#pprint(self.df['state_name'].map(unique_states))</span>
        self<span class="token punctuation">.</span>df<span class="token punctuation">[</span><span class="token string">'state_node'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>df<span class="token punctuation">[</span><span class="token string">'state_node'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>unique_states<span class="token punctuation">.</span>state_name<span class="token punctuation">,</span>  unique_states<span class="token punctuation">.</span>state_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">#pprint(self.df)</span>

        
     
        <span class="token comment">#mask = dfd['a'].str.startswith('o')</span>
        
        
        <span class="token comment">#self.df['state_nodes'] = self.df.apply(lambda x: neo.create_state_node(name = x.state_name, code = x.state) if x not in states_dict else states_dict[x], axis=1)</span>
        
    <span class="token keyword">def</span> <span class="token function">nodify_url_column</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>df<span class="token punctuation">[</span><span class="token string">'url_node'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>df<span class="token punctuation">[</span><span class="token string">'realtor_url'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_url_node<span class="token punctuation">(</span>url <span class="token operator">=</span> x<span class="token punctuation">,</span> searched<span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


    

<span class="token keyword">def</span> <span class="token function">get_cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cwd <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cwd

<span class="token keyword">def</span> <span class="token function">get_files</span><span class="token punctuation">(</span>cwd <span class="token operator">=</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> input_directory <span class="token operator">=</span> <span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    path <span class="token operator">=</span> os<span class="token punctuation">.</span>sep<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>cwd<span class="token punctuation">,</span>input_directory<span class="token punctuation">]</span><span class="token punctuation">)</span>
    file_list<span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">"**/*.json"</span><span class="token punctuation">,</span> recursive<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  
    <span class="token keyword">return</span> file_list

<span class="token keyword">def</span> <span class="token function">instantiate_neo_model_api</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    uri <span class="token operator">=</span> <span class="token string">"7a92f171.databases.neo4j.io"</span>
    user <span class="token operator">=</span> <span class="token string">"neo4j"</span>
    psw <span class="token operator">=</span> <span class="token string">'RF4Gr2IJTNhHlW6HOrLDqz_I2E2Upyh7o8paTwfnCxg'</span>
    <span class="token keyword">return</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>instantiate_neo_model_session<span class="token punctuation">(</span>uri<span class="token operator">=</span>uri<span class="token punctuation">,</span>user<span class="token operator">=</span>user<span class="token punctuation">,</span>psw<span class="token operator">=</span>psw<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">prepare_data_pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    pipeline_functions <span class="token operator">=</span> DataPipelineFunctions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    master_df <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>load_data_to_pandas_df<span class="token punctuation">(</span><span class="token punctuation">)</span>
    master_df<span class="token punctuation">[</span><span class="token string">'country_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>add_country_name<span class="token punctuation">(</span><span class="token punctuation">)</span>
    master_df<span class="token punctuation">[</span><span class="token string">'country_code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>add_country_code<span class="token punctuation">(</span><span class="token punctuation">)</span>
    master_df <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>rename_columns<span class="token punctuation">(</span>master_df<span class="token punctuation">)</span>
    master_df<span class="token punctuation">[</span><span class="token string">'city_node'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>create_city_nodes<span class="token punctuation">(</span>master_df<span class="token punctuation">)</span>
    master_df<span class="token punctuation">[</span><span class="token string">'url_node'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>create_url_nodes<span class="token punctuation">(</span>master_df<span class="token punctuation">)</span>
    master_df<span class="token punctuation">[</span><span class="token string">'root_node'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>create_root_nodes<span class="token punctuation">(</span>master_df<span class="token punctuation">)</span>

    
    master_df_path <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>write_df_to_csv<span class="token punctuation">(</span>master_df<span class="token punctuation">,</span><span class="token string">'master_df.csv'</span><span class="token punctuation">)</span>

    

    
    state_df <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>return_unique_state_df<span class="token punctuation">(</span>master_df<span class="token punctuation">)</span>
    state_df<span class="token punctuation">[</span><span class="token string">'state_node'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>create_state_nodes<span class="token punctuation">(</span>state_df<span class="token punctuation">)</span>
    state_df_path <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>write_df_to_csv<span class="token punctuation">(</span>state_df<span class="token punctuation">,</span><span class="token string">'state_df.csv'</span><span class="token punctuation">)</span>
    

    country_df <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>return_unique_country_df<span class="token punctuation">(</span>master_df<span class="token punctuation">)</span>
    country_df<span class="token punctuation">[</span><span class="token string">'country_node'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>create_country_nodes<span class="token punctuation">(</span>country_df<span class="token punctuation">)</span>
    country_df_path <span class="token operator">=</span> pipeline_functions<span class="token punctuation">.</span>write_df_to_csv<span class="token punctuation">(</span>country_df<span class="token punctuation">,</span><span class="token string">'country.csv'</span><span class="token punctuation">)</span>


    



    <span class="token comment">#upload nodes</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">"master_df"</span> <span class="token punctuation">:</span> master_df<span class="token punctuation">,</span> <span class="token string">'state_df'</span> <span class="token punctuation">:</span> state_df<span class="token punctuation">,</span> <span class="token string">'country_df'</span><span class="token punctuation">:</span> country_df<span class="token punctuation">}</span>



<span class="token keyword">def</span> <span class="token function">load_json_data</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> <span class="token builtin">open</span> <span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span>
  
    <span class="token comment"># Reading from file</span>
    data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> data


<span class="token keyword">def</span> <span class="token function">json_pipeline</span><span class="token punctuation">(</span>file_list<span class="token punctuation">,</span> master_subject_table<span class="token punctuation">)</span><span class="token punctuation">:</span>
    case_counter <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>
        
        data <span class="token operator">=</span> load_json_data<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'results'</span><span class="token punctuation">]</span>
        <span class="token comment">#pprint(data)</span>
        <span class="token comment">#pprint(data[0])</span>
        
        <span class="token comment">#filtered_data = filter_json_data(json_data = data, filter = filter)</span>

        <span class="token comment"># Creating the case nodes transaction nodes and df</span>
        data <span class="token operator">=</span> clean_json_data<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        case_data <span class="token operator">=</span> stringify_json_values<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        case_data <span class="token operator">=</span> pandify_case_data<span class="token punctuation">(</span>case_data<span class="token punctuation">)</span>
        case_data <span class="token operator">=</span> nodify_case_data<span class="token punctuation">(</span>case_data <span class="token operator">=</span> case_data<span class="token punctuation">)</span>
        
        <span class="token comment"># Creating the subject nodes transaction nodes and df</span>
        subject_list <span class="token operator">=</span> slice_subject_data<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        subject_list <span class="token operator">=</span> identify_unique_subjects<span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span>
        subject_lookup_table <span class="token operator">=</span> create_subject_lookup_table<span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span>
        master_subject_table <span class="token operator">=</span> integrate_to_master_table<span class="token punctuation">(</span>subject_lookup_table<span class="token punctuation">,</span>master_subject_table<span class="token punctuation">)</span>
        <span class="token comment">#pprint(master_subject_table.duplicated())</span>
        case_counter <span class="token operator">=</span> case_counter <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>case_data<span class="token punctuation">)</span>

        master_subject_table <span class="token operator">=</span> nodify_subjects<span class="token punctuation">(</span>master_subject_table<span class="token punctuation">)</span>

        <span class="token comment">#pprint(case_data)</span>
        <span class="token comment">#pprint(master_subject_table['transaction'])</span>
        <span class="token comment">#lets save data to the database</span>

        master_subject_table <span class="token operator">=</span> submit_subjects_to_db<span class="token punctuation">(</span>master_subject_table<span class="token punctuation">)</span>
        case_data <span class="token operator">=</span> submit_cases_to_db<span class="token punctuation">(</span>case_data <span class="token operator">=</span> case_data<span class="token punctuation">)</span>

        <span class="token comment"># Create Relationships</span>

        relationship_list<span class="token operator">=</span> create_relationship_table<span class="token punctuation">(</span>case_data<span class="token operator">=</span>case_data<span class="token punctuation">,</span> master_subject_table<span class="token operator">=</span>master_subject_table<span class="token punctuation">)</span>
    




<span class="token keyword">def</span> <span class="token function">submit_cases_to_db</span><span class="token punctuation">(</span>case_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>

        <span class="token comment">### in theory none of the cases wouldhave been submitted becasue i am pulling them from file.  There is no need to check.. Just submit</span>
    <span class="token comment">#non_submitted_nodes = case_data[case_data['submitted'].isna()].copy()</span>
    <span class="token comment">#pprint(non_submitted_nodes)</span>
    <span class="token comment">##pprint(non_submitted_nodes)</span>
    <span class="token comment">#if non_submitted_nodes.empty:</span>
    <span class="token comment">#    return case_data</span>
    <span class="token comment">#else:</span>
    case_data<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> case_data<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>update<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#Assume all are submitted..</span>
    case_data<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token comment">#test = non_submitted_nodes.iloc[32]['transaction']</span>
    <span class="token comment">#return_obj = neo.neoAPI.update(test)</span>
    <span class="token comment">#case_data.update(non_submitted_nodes)</span>
    <span class="token keyword">return</span> case_data

    <span class="token comment">#Relationships must need to be created following saving to the df</span>
    <span class="token comment">#relationships = create_relationship_table(case_data, master_subject_table)</span>

<span class="token keyword">def</span> <span class="token function">submit_subjects_to_db</span><span class="token punctuation">(</span>master_subject_table<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#unsubmitted = master_subject_table[master_subject_table.notna()]</span>
    <span class="token comment">#pprint(master_subject_table)</span>
    <span class="token comment">#non_submitted_nodes=master_subject_table[[master_subject_table['submitted'] == np.nan]]</span>
    non_submitted_nodes <span class="token operator">=</span> master_subject_table<span class="token punctuation">[</span>master_subject_table<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#pprint(non_submitted_nodes)</span>
    <span class="token keyword">if</span> non_submitted_nodes<span class="token punctuation">.</span>empty<span class="token punctuation">:</span>   
        <span class="token keyword">return</span> master_subject_table
    <span class="token keyword">else</span><span class="token punctuation">:</span>
         <span class="token comment">#pprint(non_submitted_nodes)</span>
        non_submitted_nodes<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> non_submitted_nodes<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>update<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        non_submitted_nodes<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    
    <span class="token comment">#test = non_submitted_nodes.iloc[32]['transaction']</span>
    <span class="token comment">#return_obj = neo.neoAPI.update(test)</span>
        master_subject_table<span class="token punctuation">.</span>update<span class="token punctuation">(</span>non_submitted_nodes<span class="token punctuation">)</span>
        <span class="token comment">#pprint(master_subject_table)</span>
        <span class="token keyword">return</span> master_subject_table

<span class="token keyword">def</span> <span class="token function">tester</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"Hello Dolly"</span>

<span class="token keyword">def</span> <span class="token function">create_relationship_table</span><span class="token punctuation">(</span>case_data<span class="token punctuation">,</span> master_subject_table<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#pprint(case_data[])</span>
        <span class="token comment">#test = master_subject_table['subject']</span>
        <span class="token comment"># select </span>
    relationship_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>case_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        unique_dataframe <span class="token operator">=</span> <span class="token punctuation">(</span>master_subject_table<span class="token punctuation">[</span>master_subject_table<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isin<span class="token punctuation">(</span>case_data<span class="token punctuation">[</span><span class="token string">'subject_list'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment">#pprint(unique_dataframe)</span>
        <span class="token keyword">for</span> subject_row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>unique_dataframe<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">case</span> <span class="token operator">=</span> case_data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span>
            subject <span class="token operator">=</span> unique_dataframe<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>subject_row<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span>
            <span class="token comment">#create relationship</span>
            <span class="token comment">#pprint(case)</span>
            <span class="token comment">#pprint(subject)</span>
            relationship <span class="token operator">=</span> neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_relationship<span class="token punctuation">(</span><span class="token keyword">case</span><span class="token punctuation">.</span>subject_relationship<span class="token punctuation">,</span>subject<span class="token punctuation">)</span>
            <span class="token comment">#pprint(relationship)</span>
            relationship_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>relationship<span class="token punctuation">)</span>

    <span class="token keyword">return</span> relationship_list




        
    <span class="token comment">#create relationship between the case and each uid in the unique_data_frame_transaction_list </span>
    pprint<span class="token punctuation">(</span>unique_dataframe<span class="token punctuation">)</span>


    <span class="token comment">## Creating the realation table</span>

    <span class="token comment"># Thoughts</span>
    <span class="token comment"># pass subject and case table</span>
    <span class="token comment"># case_subject list collumn</span>
    <span class="token comment"># where that list is in the master table</span>
        <span class="token comment">#return  the subjects </span>
    <span class="token comment"># make a connection to between each subject and the case in the returned tableuid in the table</span>
    <span class="token comment"># return a transaction list </span>
    <span class="token comment"># with the list commit a transaction for eachn </span>
    <span class="token comment">#</span>

    <span class="token comment">#case_data= filter_case_data(data)</span>
<span class="token keyword">def</span> <span class="token function">nodify_case_data</span><span class="token punctuation">(</span>case_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#non_submitted_nodes = case_data[case_data.notna()]</span>
    non_submitted_nodes <span class="token operator">=</span> case_data<span class="token punctuation">[</span>case_data<span class="token punctuation">.</span>notna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment">#pprint(non_submitted_nodes)</span>
    case_nodes <span class="token operator">=</span> non_submitted_nodes<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_case_node<span class="token punctuation">(</span>date <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dates<span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'dates'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>group <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'group'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span>x<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pdf<span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'pdf'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shelf_id <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'shelf_id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> subject<span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> title <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> url <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> subject_relationship<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

    case_data<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> case_nodes
    <span class="token keyword">return</span> case_data




<span class="token keyword">def</span> <span class="token function">filter_case_data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pprint<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>



<span class="token keyword">def</span> <span class="token function">nodify_subjects</span><span class="token punctuation">(</span>master_subject_table<span class="token punctuation">)</span><span class="token punctuation">:</span>
    non_submitted_nodes <span class="token operator">=</span> master_subject_table<span class="token punctuation">[</span>master_subject_table<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#df[df.isna().any(axis=1)]</span>
    <span class="token comment">#pprint(non_submitted_nodes)</span>
    non_submitted_nodes<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> non_submitted_nodes<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x <span class="token punctuation">:</span>neo<span class="token punctuation">.</span>neoAPI<span class="token punctuation">.</span>create_subject_node<span class="token punctuation">(</span>name <span class="token operator">=</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    master_subject_table<span class="token punctuation">.</span>update<span class="token punctuation">(</span>non_submitted_nodes<span class="token punctuation">)</span>
    <span class="token keyword">return</span> master_subject_table

<span class="token keyword">def</span> <span class="token function">integrate_to_master_table</span><span class="token punctuation">(</span>subject_lookup_table<span class="token punctuation">,</span> master_subject_table<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#check_if subject in list is in subject of the table</span>
    <span class="token comment"># if so drop it from the temp table</span>
    <span class="token comment"># append what is left to the master table </span>
    <span class="token comment">#pprint(subject_lookup_table)</span>
    test <span class="token operator">=</span> master_subject_table<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span>
    unique_dataframe <span class="token operator">=</span> <span class="token punctuation">(</span>subject_lookup_table<span class="token punctuation">[</span><span class="token operator">~</span>subject_lookup_table<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isin<span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">#pprint(unique_dataframe)</span>
    <span class="token comment">#duplicate_list = (master_subject_table[~master_subject_table['subject'].isin(subject_lookup_table['subject'])])</span>
    master_subject_table <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>master_subject_table<span class="token punctuation">,</span>unique_dataframe<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">#master_subject_table.update(unique_dataframe)</span>
    master_subject_table<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment">#pprint(master_subject_table)</span>
    <span class="token comment">#pprint(master_subject_table.duplicated())</span>
    <span class="token keyword">return</span> master_subject_table

<span class="token keyword">def</span> <span class="token function">create_subject_lookup_table</span><span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    lookup_table <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>subject_list<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    lookup_table<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    lookup_table<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    <span class="token keyword">return</span> lookup_table

<span class="token keyword">def</span> <span class="token function">identify_unique_subjects</span><span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment"># insert the list to the set</span>
    list_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>subject_list<span class="token punctuation">)</span>
    <span class="token comment"># convert the set to the list</span>
    unique_list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>list_set<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> unique_list

<span class="token keyword">def</span> <span class="token function">slice_subject_data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    subject_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token keyword">case</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        subject_list <span class="token operator">=</span> subject_list <span class="token operator">+</span> <span class="token keyword">case</span><span class="token punctuation">[</span><span class="token string">'subject_list'</span><span class="token punctuation">]</span>
    <span class="token comment">#pprint(subject_list)</span>
    <span class="token keyword">return</span> subject_list

<span class="token keyword">def</span> <span class="token function">pandify_case_data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#case_df = pd.concat(data, sort=False)</span>
    df<span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    df<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    <span class="token keyword">return</span> df
        
<span class="token keyword">def</span> <span class="token function">stringify_json_values</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> <span class="token builtin">dict</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        subject_list <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> key <span class="token keyword">in</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
                tmp_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    item <span class="token operator">=</span> item<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span>
                    tmp_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
                <span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> tmp_list

                <span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token builtin">dict</span><span class="token punctuation">[</span><span class="token string">'subject_list'</span><span class="token punctuation">]</span> <span class="token operator">=</span> subject_list

                
    <span class="token keyword">return</span> data
                

    <span class="token comment">#pprint(data)</span>

<span class="token keyword">def</span> <span class="token function">clean_json_data</span><span class="token punctuation">(</span>filtered_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Select the keys that I want from the dictionary</span>
    <span class="token comment"># filter appropriatly into a df </span>
    <span class="token comment"># write df to file</span>
    <span class="token comment">#print(type(filtered_data))</span>
    <span class="token comment">#pprint(filtered_data)</span>
    <span class="token keyword">for</span> data <span class="token keyword">in</span> filtered_data<span class="token punctuation">:</span>
        <span class="token comment">#pprint(data)</span>
        <span class="token comment">#creat a dictionary of columns and values for each row.  Combine them all into a df when we are done</span>
        <span class="token comment"># each dictionary must be a row.... which makes perfect sense, but they can not be nested... </span>
        item <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        resources <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'resources'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        index <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        language <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'language'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        online_format<span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'online_format'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        original_format <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'original_format'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        kind <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        image_url <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'image_url'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        hassegments <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'hassegments'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        extract_timestamp <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'extract_timestamp'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        timestampe <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'timestamp'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        mimetype<span class="token operator">=</span>data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'mime_type'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            pdf <span class="token operator">=</span> resources<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'pdf'</span><span class="token punctuation">]</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span> 
            pdf <span class="token operator">=</span> <span class="token string">"noPdf"</span>
        data<span class="token punctuation">[</span><span class="token string">"pdf"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pdf
        data<span class="token punctuation">[</span><span class="token string">'search_index'</span><span class="token punctuation">]</span> <span class="token operator">=</span> index
    


    <span class="token comment"># convert to strings maybe move into another function to be called.  Actually will definitely move to a nother function </span>

    <span class="token keyword">return</span> filtered_data
    <span class="token comment">#uid = UniqueIdProperty()</span>
    <span class="token comment">##date = date</span>
    <span class="token comment">#dates = dates</span>
    <span class="token comment">#group = group</span>
    <span class="token comment">#id = id </span>
    <span class="token comment">#pdf = pdf </span>
    <span class="token comment">#shelf_id = shelf_id</span>
    <span class="token comment">#subject = subject</span>
    <span class="token comment">#primary_topic = primary_topic</span>
    <span class="token comment">#title = title</span>
    <span class="token comment">#url = url</span>
    <span class="token comment">#description = description</span>
    <span class="token comment">#source_collection = source_collection</span>




<span class="token keyword">def</span> <span class="token function">filter_json_data</span><span class="token punctuation">(</span>json_data<span class="token punctuation">,</span> <span class="token builtin">filter</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Using dict()</span>
    <span class="token comment"># Extracting specific keys from dictionary</span>

    <span class="token builtin">filter</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'contributor'</span><span class="token punctuation">,</span><span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token string">'dates'</span><span class="token punctuation">,</span> <span class="token string">'digitized'</span><span class="token punctuation">]</span>
    res <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> json_data<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">filter</span> <span class="token keyword">if</span> k <span class="token keyword">in</span> json_data<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">create_master_subject_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    table <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>
    table<span class="token punctuation">[</span><span class="token string">'subject'</span><span class="token punctuation">]</span><span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    table<span class="token punctuation">[</span><span class="token string">'transaction'</span><span class="token punctuation">]</span><span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    table<span class="token punctuation">[</span><span class="token string">'submitted'</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>nan
    <span class="token keyword">return</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    neo_applified <span class="token operator">=</span> instantiate_neo_model_api<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cwd <span class="token operator">=</span> get_cwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
    file_list <span class="token operator">=</span> get_files<span class="token punctuation">(</span>cwd <span class="token operator">=</span> cwd<span class="token punctuation">)</span>
    master_subject_table <span class="token operator">=</span> create_master_subject_table<span class="token punctuation">(</span><span class="token punctuation">)</span>
    json_pipeline<span class="token punctuation">(</span>file_list<span class="token operator">=</span>file_list<span class="token punctuation">,</span> master_subject_table<span class="token operator">=</span>master_subject_table<span class="token punctuation">)</span>
    
    <span class="token comment">#neo_sandbox_app = instantiate_neo_sandbox_app()</span>
    <span class="token comment">#google_creds = load_google_creds()</span>
    <span class="token comment">#sheets_app = instantiate_sheets_app(google_creds.credentials)</span>
    <span class="token comment">#drive_app = instantiate_drive_app(google_creds.credentials)</span>
    <span class="token comment">#googleAPI = instantiate_google_API()</span>
    <span class="token comment">#sparkAPI = instantiate_spark_API()</span>
    <span class="token comment">#neoAPI = NeoAPI()</span>
    <span class="token comment">#nodified_df = pandas_functions.nodify_dataframe()</span>
    <span class="token comment">#test()</span>
    <span class="token comment">#google_api = googleServices.GoogleAPI()</span>
    <span class="token comment">###neo_model_api = instantiate_neo_model_api()</span>
    <span class="token comment">###df_pipeline_dictionary = prepare_data_pipeline()</span>
    <span class="token comment">#final_df_dictionary = upload_data_pipeline_to_neo(df_pipeline_dictionary)</span>
    <span class="token comment">#for k,v in final_df_dictionary.items():</span>
    <span class="token comment">#    cwd = os.getcwd()</span>
    <span class="token comment">#    path = str(k) +"Final"</span>
    <span class="token comment">#    path = os.sep.join([cwd,path])</span>

     <span class="token comment">#   with open(path, "w") as file:</span>
     <span class="token comment">#       v.to_csv(path, index=False)</span>

    <span class="token comment">#prepared_dfs = prepare_pandas_df()</span>
    <span class="token comment">#pprint(prepared_df)</span>
    <span class="token comment">#upload_df_to_db(df = prepared_df, neo_model_api = neo_model_api)</span>
</code></pre></div></section><hr/><footer><div class="bio"><p>Maintained by <strong>Justin Napolitano</strong>. <!-- --> <a href="https://twitter.com/just_napolitano">Follow me on Twitter</a></p></div></footer></article><nav class="blog-post-nav"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/loc_crawler/">← <!-- -->Crawling the Library of Congress API</a></li><li><a rel="next" href="/constitution_to_neo/">Integrating The US Constitution into Neo4j for ML Trickery <!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2022<!-- -->, Created by<!-- --> <a href="https://jnapolitano.io">Justin Napolitano</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/neo4j_integration/";window.___webpackCompilationHash="d94363f05044c33a6781";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-67664a8ccc6c9f02b880.js"],"app":["/app-c8d1e6b1e07552f29524.js"],"component---src-pages-404-js":["/component---src-pages-404-js-27981ca7dd461cb4280e.js"],"component---src-pages-index-js":["/component---src-pages-index-js-59a21146d37aa180d12f.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-2f9b97cf148785549d09.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-2fd61fd1c97edc75b172.js"]};/*]]>*/</script><script src="/polyfill-67664a8ccc6c9f02b880.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-2fd61fd1c97edc75b172.js" async=""></script><script src="/commons-9979cba14fa891b0ecd4.js" async=""></script><script src="/app-c8d1e6b1e07552f29524.js" async=""></script><script src="/framework-e413e527015be9a1bdfd.js" async=""></script><script src="/webpack-runtime-8d4d3bcfd5afb11d1043.js" async=""></script></body></html>